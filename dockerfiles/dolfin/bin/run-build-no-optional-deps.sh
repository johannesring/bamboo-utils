#!/bin/bash

export FENICS_BUILD_TYPE=${FENICS_BUILD_TYPE:-"Developer"}
export VERBOSE=${VERBOSE:-1}
export PROCS=${PROCS:-1}

# Turn off all optional dependencies
export CMAKE_EXTRA_ARGS="-DDOLFIN_ENABLE_TESTING:BOOL=ON -DDOLFIN_ENABLE_BENCHMARKS:BOOL=ON -DDOLFIN_ENABLE_PETSC:BOOL=OFF -DDOLFIN_ENABLE_PETSC4PY:BOOL=OFF -DDOLFIN_ENABLE_SLEPC:BOOL=OFF -DDOLFIN_ENABLE_SLEPC4PY:BOOL=OFF -DDOLFIN_ENABLE_TRILINOS:BOOL=OFF -DDOLFIN_ENABLE_SCOTCH:BOOL=OFF -DDOLFIN_ENABLE_OPENMP:BOOL=OFF -DDOLFIN_ENABLE_MPI:BOOL=OFF -DDOLFIN_ENABLE_UMFPACK:BOOL=OFF -DDOLFIN_ENABLE_CHOLMOD:BOOL=OFF -DDOLFIN_ENABLE_PARMETIS:BOOL=OFF -DDOLFIN_ENABLE_ZLIB:BOOL=OFF -DDOLFIN_ENABLE_VTK:BOOL=OFF -DDOLFIN_ENABLE_PYTHON:BOOL=OFF -DDOLFIN_ENABLE_HDF5:BOOL=OFF -DDOLFIN_ENABLE_SPHINX:BOOL=OFF"

# Clean up build directory
rm -rf ${FENICS_HOME}/src/dolfin/build/*

# Recompile
fenics-build dolfin

# Build C++ unit tests, demos and benchmarks
cd ${FENICS_HOME}/src/dolfin/build
make -j${PROCS} tests
make -j${PROCS} demo
make -j${PROCS} bench
